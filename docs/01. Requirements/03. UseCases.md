# UseCases

## UDF 등록 및 관리

- 사용자가 정의한 UDF(User Defined Function) 를 등록하고, 이를 DAG 에서 활용 할 수 있도록 관리

### 기본 흐름

1. 사용자가 python 으로 UDF 생성 규칙에 맞춰 코드를 작성한다.
2. 작성한 UDF, requirements.txt, 메타데이터(입력값, 출력값) 을 업로드 한다.
3. 검증이 완료되면 데이터베이스에 UDF 정보를 저장 하고, UDF 파일과 디펜던시 파일을 파일시스템에 저장한다.
4. 사용자는 등록된 UDF 목록을 조회 할 수 있다.

### 예외 흐름

- UDF 파일의 규칙이 준수하지 않으면 업로드가 거부된다.

## DAG 생성 및 저장

- 사용자가 여러 UDF 를 조합 하여 DAG 를 생성하고 관리 할 수 있다.

### 기본 흐름

1. 사용자가 UI 에서 UDF 를 이용하여 Drag & Drop 형식으로 DAG 를 구성한다.
2. 각 Task 에 대한 입력값을 설정하고, Task 간의 Edge(의존성)을 정의한다.
3. DAG 이름과 설명을 입력하고 저장을 요청한다.
4. 시스템은 입력된 조건을 이용하여 DAG(Airflow) 를 생성하고, 메타데이터를 데이터베이스에 저장한다.
5. 사용자는 생성된 DAG 를 확인한다.

### 예외 흐름

- 입력값이 필수 항목을 충족하지 못하면 오류를 발생한다.
- Task 간 의존성이 순환 구조일 경우 오류를 발생한다.
- 동일한 이름의 DAG가 존재 할 경우 중복 등록을 거부한다.

## Task 입력값 설정 및 유효성 검사

- 사용자가 Task 설정시 입력값을 설정 할 수 있으며, UDF 의 포멧에 맞게 확인한다.

### 기본 흐름

1. 사용자가 DAG 생성시 각 Task 에 대한 입력값을 설정한다.
2. 시스템은 Task 의 입력값이 정의된 형식(문자열, 숫자 등) 에 맞는지 검증한다.
3. 입력값이 정상적으로 설정이 되면 DAG 를 생성한다.

### 예외 흐름

- 입력값의 잘못된 타입(예; 숫자필드에 문자열 입력) 일 경우 오류 발생
- 필수 입력값이 누락된 경우 오류 발생
- 이전 Task 의 Output 과 다음 Task 의 Input 타입이 다르면 오류 발생

## DAG 실행

- 사용자가 저장된 DAG 를 실행하고, Task 상태를 실시간으로 조회 한다.

### 기본 흐름

1. 사용자가 DAG 를 선택하고, 실행 버튼을 클릭한다.
2. 시스템은 DAG 를 실행하고, 각 Task 를 정의된 순서대로 실행한다.
3. 각 Task 의 실행 결과 를 다음 Task 의 input 으로 전달한다.
4. DAG 실행이 완료되면 실행 로그를 저장한다.
5. 사용자는 DAG 실행 상태와 결과를 조회 할 수 있다.

### 예외 흐름

- DAG 실행 중 Task 실패시 재시도 정책이 적용됨
- 특정 Task 가 너무 오래 실행 되면 타임아웃 처리
- DAG 실행 중 서버 장애가 발생하면 자동 복구 또는 실패 처리

## DAG 실행 상태 및 로그 조회

- 사용자가 실행중이거나 완료된 DAG 의 상태 및 실행 로그를 확인 할 수 있다.

### 기본 흐름

1. 사용자가 실행된 DAG 목록을 조회한다.
2. 특정 DAG 를 선택하면, 각 Task 의 실행 상태를 확인 할 수 있다.
3. 실행 로그를 조회하여 상세한 실행 내역을 확인 할 수 있다.

### 예외 흐름

- DAG 실행 이력이 없으면 목록이 비어 있다.
- 특정 DAG 의 실행 로그가 삭제되었거나 보존 기간을 넘기면 로그 조회가 불가능하다.
